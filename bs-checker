#!/usr/bin/perl

use strict;
use warnings;
use feature 'say';

use Web::Query;
use JSON;

my $results;

while (<>) {
  next if /^#/;
  my $result;
  chomp;
  $result->{url} = $_;

  my $q = wq($_)->find('link[rel="stylesheet"]');

  $q->each(sub {
    my $href = $_->attr('href');
    return unless $href =~ /bootstrap\.(min\.)?css/;
    my ($ver) = $href =~ /(\d+\.\d+\.\d+)/;
    if ($ver) {
      $result->{version} = $ver;
    } else {
      warn "Can't find version in $href ($result->{url})\n";
      $result->{version} = '0.0.0';
    }
  });

  push @$results, $result;
}

say JSON->new->pretty->encode($results);

